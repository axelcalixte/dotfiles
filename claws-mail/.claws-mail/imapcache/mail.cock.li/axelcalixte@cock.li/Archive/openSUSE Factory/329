Return-Path: <opensuse-factory+bounces-96173-axelcalixte=cock.li@opensuse.org>
Delivered-To: axelcalixte@cock.li
Received: by mx1.cock.li (Postfix, from userid 65534)
	id 7D61A829D6; Wed, 26 Aug 2020 17:13:16 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on de8f7fd56dc0
X-Spam-Level: 
X-Spam-Status: No, score=-0.9 required=5.0 tests=BAYES_40,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_LOW,RDNS_NONE,URIBL_BLOCKED shortcircuit=_SCTYPE_
	autolearn=disabled version=3.4.2
Received: from hydra.opensuse.org (unknown [IPv6:2001:67c:2178:8::18])
	by mx1.cock.li (Postfix) with ESMTPS id 4A21982A71
	for <axelcalixte@cock.li>; Wed, 26 Aug 2020 16:09:10 +0000 (UTC)
Received: from lists5.opensuse.org (baloo.infra.opensuse.org [192.168.47.38])
	by hydra.opensuse.org (Postfix) with ESMTP id 50B0B217B1
	for <axelcalixte@cock.li>; Wed, 26 Aug 2020 16:07:38 +0000 (UTC)
Received: from baloo.infra.opensuse.org (localhost [127.0.0.1])
	by lists5.opensuse.org (Postfix) with ESMTP id 38D2B11B1B;
	Wed, 26 Aug 2020 16:07:38 +0000 (UTC)
X-Original-To: opensuse-factory@lists5.opensuse.org
Delivered-To: opensuse-factory@lists5.opensuse.org
Received: from relay2.suse.de (unknown [195.135.221.27])
	by lists5.opensuse.org (Postfix) with ESMTP id 3238D11B1B
	for <opensuse-factory@lists5.opensuse.org>; Wed, 26 Aug 2020 16:07:38 +0000 (UTC)
Received: from suse.cz (dhcp39.suse.cz [10.100.51.39])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by relay2.suse.de (Postfix) with ESMTPS id B10DB2C958
	for <opensuse-factory@opensuse.org>; Wed, 26 Aug 2020 16:07:39 +0000 (UTC)
From: Martin Jambor <mjambor@suse.cz>
To: opensuse-factory@opensuse.org
Cc: 
Subject: [opensuse-factory] emacs 27: A lot of Wrong type argument errors  
User-Agent: Notmuch/0.30 (https://notmuchmail.org) Emacs/27.1
 (x86_64-suse-linux-gnu)
Date: Wed, 26 Aug 2020 18:07:37 +0200
Message-ID: <ri6zh6hpf06.fsf@suse.cz>
Precedence: bulk
Mailing-List: contact opensuse-factory+help@opensuse.org; run by mlmmj
X-Mailinglist: opensuse-factory
List-Post: <mailto:opensuse-factory@opensuse.org>
List-Help: <mailto:opensuse-factory+help@opensuse.org>
List-Subscribe:  <mailto:opensuse-factory+subscribe@opensuse.org>
List-Unsubscribe:  <mailto:opensuse-factory+unsubscribe@opensuse.org>
List-Owner: <mailto:opensuse-factory+owner@opensuse.org>
List-Archive: <http://lists.opensuse.org/opensuse-factory/>
X-MIME-Notice: attachments may have been removed from this message
MIME-Version: 1.0
Content-Type: text/plain

Hi,

after updating to TW 20200824 with emacs-27.1-2.1.x86_64 (previously I
had some emacs 26), very many actions fail with error:

   Wrong type argument: stringp, (require . info)

For example, I cannot even enter org-mode by simply M-x org-mode in
the *scratch* buffer.  I also cannot run notmuch and keep getting this
error repeatedly in list-packages buffer.

I have tracked this down to melpa packages magit and/or emacs-jabber.
When I delete the directory .emacs.d/elpa and install my usual packages
but not any of these two, the problem goes away.  If I install one of
them, it reappears.  The packages are not part of TW and therefore I am
not submitting a bug but I assume there must be quite a few magit users
here and so I'm asking whether anyone has dealt with this or has any
ideas what to do.  I must say that my world is going to be a worse place
without magit.

Even with the packages installed, the problem also does not happen when
I run directly emacs-x11, emacs-gtx or emacs-nox but does happen even
when I unset DISPLAY and run emacs (and sure enough, --no-x-resources
has no effect either).  IIUC, the /usr/bin/emacs is a SUSE specific
script and therefore I suspect it may also be a problem with our
packaging.

The simplest backtrace is from attempting to enter org-mode:

Debugger entered--Lisp error: (wrong-type-argument stringp (require . info))
  string-match("\\(\\`\\|/\\)imenu\\(\\.elc\\|\\.el\\|\\.so\\)?\\(\\.gz\\)?\\'" (require . info))
  load-history-filename-element("\\(\\`\\|/\\)imenu\\(\\.elc\\|\\.el\\|\\.so\\)?\\(\\.gz\\)?\\'")
  eval-after-load("imenu" #f(compiled-function () #<bytecode 0x9bf819>))
  require(org-compat)
  byte-code("\302\303!\210\302\304!\210\302\305!\210\302\306!\210\10\307=\204:\0\3101)\0\311\312\11!\313P\314\315\211\211%0\2029\0\210\316\317!\210\320\321!\210..." [this-command load-file-name require cl-lib calendar find-func format-spec eval-buffer (error) load file-name-directory "org-loaddefs.el" nil t message "WARNING: No org-loaddefs.el file could be found fr..." sit-for 3 "You need to run \"make\" or \"make autoloads\" from Or..." org-macs org-compat org-keys ol org-table] 6)
  autoload-do-load((autoload "org" "Outline-based notes management and organizer, alia..." t nil) org-mode)
  command-execute(org-mode record)
  execute-extended-command(nil "org-mode" "org-mode")
  funcall-interactively(execute-extended-command nil "org-mode" "org-mode")
  call-interactively(execute-extended-command nil nil)
  command-execute(execute-extended-command)


Another notable difference between running just emacs and emacs-x11,
emacs-gtk or emacs-nox is that the latter three only spit the following
(only slightly annoying) line in the terminal:

  Warning: game dir '/var/games/emacs': Permission denied

whereas running just emacs with no suffix then goes on with much more:

Loading loadup.el (source)...
dump mode: nil
Using load-path (/usr/share/emacs/27.1/site-lisp /usr/share/emacs/site-lisp /usr/share/emacs/27.1/lisp /usr/share/emacs/27.1/lisp/emacs-lisp /usr/share/emacs/27.1/lisp/progmodes /usr/share/emacs/27.1/lisp/language /usr/share/emacs/27.1/lisp/international /usr/share/emacs/27.1/lisp/textmodes /usr/share/emacs/27.1/lisp/vc)
Loading emacs-lisp/byte-run...
Loading emacs-lisp/byte-run...done
Loading emacs-lisp/backquote...
Loading emacs-lisp/backquote...done
Loading subr...
Loading subr...done
Loading version...
Loading version...done
Loading widget...
Loading widget...done
Loading custom...
Loading custom...done
Loading emacs-lisp/map-ynp...
Loading emacs-lisp/map-ynp...done
Loading international/mule...
Loading international/mule...done
Loading international/mule-conf...
Loading international/mule-conf...done
Loading env...
Loading env...done
Loading format...
Loading format...done
Loading bindings (source)...
Loading bindings (source)...done
Loading window...
Loading window...done
Loading files...
Loading files...done
Loading emacs-lisp/macroexp...
Loading emacs-lisp/macroexp...done
Loading cus-face...
Loading cus-face...done
Loading faces...
Loading faces...done
Loading button...
Loading button...done
Loading /usr/share/emacs/27.1/lisp/loaddefs.el (source)...
Loading /usr/share/emacs/27.1/lisp/loaddefs.el (source)...done
Loading emacs-lisp/nadvice...
Loading emacs-lisp/nadvice...done
Loading emacs-lisp/cl-preloaded...
Loading emacs-lisp/cl-preloaded...done
Loading obarray...
Loading obarray...done
Loading abbrev...
Loading abbrev...done
Loading simple...
Loading simple...done
Loading help...
Loading help...done
Loading jka-cmpr-hook...
Loading jka-cmpr-hook...done
Loading epa-hook...
Loading epa-hook...done
Loading international/mule-cmds...
Loading international/mule-cmds...done
Loading case-table...
Loading case-table...done
Loading /usr/share/emacs/27.1/lisp/international/charprop.el (source)...
Loading /usr/share/emacs/27.1/lisp/international/charprop.el (source)...done
Loading international/characters...
Loading international/characters...done
Loading composite...
Loading composite...done
Loading language/chinese...
Loading language/chinese...done
Loading language/cyrillic...
Loading language/cyrillic...done
Loading language/indian...
Loading language/indian...done
Loading language/sinhala...
Loading language/sinhala...done
Loading language/english...
Loading language/english...done
Loading language/ethiopic...
Loading language/ethiopic...done
Loading language/european...
Loading language/european...done
Loading language/czech...
Loading language/czech...done
Loading language/slovak...
Loading language/slovak...done
Loading language/romanian...
Loading language/romanian...done
Loading language/greek...
Loading language/greek...done
Loading language/hebrew...
Loading language/hebrew...done
Loading international/cp51932...
Loading international/cp51932...done
Loading international/eucjp-ms...
Loading international/eucjp-ms...done
Loading language/japanese...
Loading language/japanese...done
Loading language/korean...
Loading language/korean...done
Loading language/lao...
Loading language/lao...done
Loading language/tai-viet...
Loading language/tai-viet...done
Loading language/thai...
Loading language/thai...done
Loading language/tibetan...
Loading language/tibetan...done
Loading language/vietnamese...
Loading language/vietnamese...done
Loading language/misc-lang...
Loading language/misc-lang...done
Loading language/utf-8-lang...
Loading language/utf-8-lang...done
Loading language/georgian...
Loading language/georgian...done
Loading language/khmer...
Loading language/khmer...done
Loading language/burmese...
Loading language/burmese...done
Loading language/cham...
Loading language/cham...done
Loading indent...
Loading indent...done
Loading emacs-lisp/cl-generic...
Loading emacs-lisp/cl-generic...done
Loading minibuffer...
Loading minibuffer...done
Loading frame...
Loading frame...done
Loading startup...
Loading startup...done
Loading term/tty-colors...
Loading term/tty-colors...done
Loading font-core...
Loading font-core...done
Loading facemenu...
Loading facemenu...done
Loading emacs-lisp/syntax...
Loading emacs-lisp/syntax...done
Loading font-lock...
Loading font-lock...done
Loading jit-lock...
Loading jit-lock...done
Loading mouse...
Loading mouse...done
Loading scroll-bar...
Loading scroll-bar...done
Loading select...
Loading select...done
Loading emacs-lisp/timer...
Loading emacs-lisp/timer...done
Loading isearch...
Loading isearch...done
Loading rfn-eshadow...
Loading rfn-eshadow...done
Loading menu-bar...
Loading menu-bar...done
Loading tab-bar...
Loading tab-bar...done
Loading emacs-lisp/lisp...
Loading emacs-lisp/lisp...done
Loading textmodes/page...
Loading textmodes/page...done
Loading register...
Loading register...done
Loading textmodes/paragraphs...
Loading textmodes/paragraphs...done
Loading progmodes/prog-mode...
Loading progmodes/prog-mode...done
Loading emacs-lisp/lisp-mode...
Loading emacs-lisp/lisp-mode...done
Loading progmodes/elisp-mode...
Loading progmodes/elisp-mode...done
Loading textmodes/text-mode...
Loading textmodes/text-mode...done
Loading textmodes/fill...
Loading textmodes/fill...done
Loading newcomment...
Loading newcomment...done
Loading replace...
Loading replace...done
Loading emacs-lisp/tabulated-list...
Loading emacs-lisp/tabulated-list...done
Loading buff-menu...
Loading buff-menu...done
Loading fringe...
Loading fringe...done
Loading emacs-lisp/regexp-opt...
Loading emacs-lisp/regexp-opt...done
Loading image...
Loading image...done
Loading international/fontset...
Loading international/fontset...done
Loading dnd...
Loading dnd...done
Loading tool-bar...
Loading tool-bar...done
Loading dynamic-setting...
Loading dynamic-setting...done
Loading x-dnd...
Loading x-dnd...done
Loading term/common-win...
Loading term/common-win...done
Loading term/x-win...
Loading term/x-win...done
Loading mwheel...
Loading mwheel...done
Loading emacs-lisp/float-sup...
Loading emacs-lisp/float-sup...done
Loading vc/vc-hooks...
Loading vc/vc-hooks...done
Loading vc/ediff-hook...
Loading vc/ediff-hook...done
Loading uniquify...
Loading uniquify...done
Loading electric...
Loading electric...done
Loading emacs-lisp/eldoc...
Loading emacs-lisp/eldoc...done
Loading /usr/share/emacs/27.1/lisp/cus-start.el (source)...
Loading /usr/share/emacs/27.1/lisp/cus-start.el (source)...done
Loading tooltip...
Loading tooltip...done
Loading /usr/share/emacs/27.1/lisp/leim/leim-list.el (source)...
Loading /usr/share/emacs/27.1/lisp/leim/leim-list.el (source)...done
Loading /usr/share/emacs/27.1/lisp/site-load.el (source)...
Loading lpr...
Loading lpr...done
Loading delsel...
Loading delsel...done
Loading /usr/share/emacs/27.1/lisp/site-load.el (source)...done
Finding pointers to doc strings...
Finding pointers to doc strings...done

so it seems there is quite a bit more going on when running just emacs.
But of course I do not know whether it is in any way related.

I'll be grateful for any suggestions how to fix the problem.

Martin
-- 
To unsubscribe, e-mail: opensuse-factory+unsubscribe@opensuse.org
To contact the owner, e-mail: opensuse-factory+owner@opensuse.org

